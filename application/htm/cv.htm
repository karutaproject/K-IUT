<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Mes CV du Eportfolio 4 &eacute;toiles</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
		<!-- =========================================== -->
		<link rel="stylesheet" type="text/css" href="../../other/css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="../../other/css/bootstrap-responsive.min.css" />
		<link rel="stylesheet" type="text/css" href="../../other/css/bootstrap-wysihtml5.css" />
		<link rel="stylesheet" type="text/css" href="../../other/css/jquery-ui.css" />
		<link rel="stylesheet" type="text/css" href="../../other/css/font-awesome/css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="../../karuta/css/karuta.css" />
		<link rel="stylesheet" type="text/css" href="../../karuta/css/welcome.css"/>
		<!-- =========================================== -->
		<link rel="stylesheet" href="../../application/css/specific.css" />
		<!-- =========================================== -->
		<script src="../../other/js/jquery-1.10.2.js"></script>
		<script src="../../other/js/jquery-ui-1.10.3.custom.min.js"></script>
		<script src="../../other/bootstrap/js/bootstrap.min.js"></script>
		<script src='../../other/wysihtml5/wysihtml5-0.3.0.js'> </script>
		<script src='../../other/wysihtml5/parser.js'> </script>
		<!--[if lt IE 9]>
			<script src='http://html5shiv.googlecode.com/svn/trunk/html5.js'></script>
		<![endif]-->
		<script src="../../other/js/bootstrap-wysihtml5.js"></script>
		<script src="../../other/js/jquery_hotkeys.js"></script>
		<!--script src="../../other/js/bootstrap-wysiwyg.js"></script-->
		<!-- =============================================================== -->
		<script src="../../karuta/js/karuta.js"></script>
		<script src="../../karuta/js/UICom.js"></script>
		<!-- =============================================================== -->
		<script src="../../karuta/js/model/Type_Portfolio.js"></script>
		<script src="../../karuta/js/model/Type_Node.js"></script>
		<script src="../../karuta/js/model/Type_User.js"></script>
		<script src="../../karuta/js/UICom.js"></script>
		<!-- =============================================================== -->
		<link type="text/css" href="../../other/lightbox/css/lightbox.css" rel="stylesheet" />
		<script src="../../other/lightbox/js/lightbox-2.6.min.js"></script>
		<!-- =============================================================== -->
		<link type="text/css" href="../../other/jplayer/jplayer.blue.monday.css" rel="stylesheet" />
		<script src="../../other/jplayer/jquery.jplayer.min.js"></script>
		<!-- =============================================================== -->
		<script src="../../other/js/jquery.ui.widget.js"></script>
		<script src="../../other/js/jquery.iframe-transport.js"></script>
		<script src="../../other/js/jquery.fileupload.js"></script>
		<!-- =============================================================== -->
		<script src="../../other/bootstrap-datepicker/bootstrap-datepicker.js"></script>
		<script src="../../other/bootstrap-datepicker/bootstrap-datepicker.fr.js"></script>
		<link rel="stylesheet" href="../../other/bootstrap-datepicker/datepicker.css" />
		<!-- =============================================================== -->
		<script src="../../karuta/js/resources/Type_Calendar.js"></script>
		<script src="../../karuta/js/resources/Type_Comments.js"></script>
		<script src="../../karuta/js/resources/Type_Document.js"></script>
		<script src="../../karuta/js/resources/Type_Proxy.js"></script>
		<script src="../../karuta/js/resources/Type_TextField.js"></script>
		<script src="../../karuta/js/resources/Type_Field.js"></script>
		<script src="../../karuta/js/resources/Type_Image.js"></script>
		<script src="../../karuta/js/resources/Type_Get_Resource.js"></script>
		<script src="../../karuta/js/resources/Type_Get_Get_Resource.js"></script>
		<script src="../../karuta/js/resources/Type_URL.js"></script>
		<script src="../../karuta/js/resources/Type_Item.js"></script>
		<script src="../../karuta/js/resources/Type_Video.js"></script>
		<script src="../../karuta/js/resources/Type_CompetencyEvaluation.js"></script>
		<!-- =============================================================== -->
		<script src="../../application/js/_init.js"></script>
		<!-- =============================================================== -->
		<script src="../../karuta/js/version.js"></script>
		<!-- =============================================================== -->
		<script src="../../karuta/js/languages/locale_fr.js"></script>
	<!-- =============================================================== -->
	<script src="../js/iut2.js"></script>
	<script src="../js/experience.js"></script>
	<script src="../js/experience_perso.js"></script>
	<script src="../js/diploma.js"></script>
	<script src="../js/stage.js"></script>
	<script src="../js/formation.js"></script>
	<script src="../js/alternance.js"></script>
	<script src="../js/competence.js"></script>
	<script src="../js/profile.js"></script>
	<script src="../js/cv.js"></script>
	<script src="../js/langue.js"></script>
	<!-- =============================================================== -->
</head>
<body>
	<div id="container" class="container">
		<div id="navbar" class="navbar navbar-fixed-top"></div>

		<ol class="breadcrumb">
			<li><a id="accueil" href="#">Accueil</a><span class="divider">/</span></li>
			<li class="active">Mes cvs<span class="divider">/</span></li>
			<li id='view_label' class="active"></li>
		</ol>

		<h3 class="align-left">MES CV</h3>

		<!-- ====================================================================== -->
		<div id="portfolio">

				<!-- ================================================================== -->
				<div class="tab-pane" id="resume">
					<div class="container">
						<!--blockquote id='description'></blockquote-->
						<div id='list_cvs'></div>
					</div>
				</div>
				<!-- ================================================================== -->
		</div>
	</div>
	<!-- ====================================================================== -->
	<div id="footer" class="container-fluid" ></div>
	<!-- ====================================================================== -->
	

	<script language='javascript'>

	var g_portfolioid = "";
	var g_profileid = "";
	var g_cvid = "";
	var l_userrole = 'etudiant';
	//-----------------------------------------------
	var ref = {} // references aux units contenant les compétences
	var htmlShort1 = "";
	var g_htmlDetail1 = "";
	var htmlShort2 = "";
	var g_htmlDetail2 = "";
	var htmlShort3 = "";
	var g_htmlDetail3 = "";
	var mother_tongueid = "";	

	document.write(EditBox());
	document.write(DeleteBox());
	document.write(savedBox());
	document.write(waitBox());
	var view = getURLParameter('view');
	if (view == null)
		view = "list";
	var view_label = new Array();
	view_label['list'] = "Lister les CV";
	view_label['create'] = "Créer un CV";
	$("#view_label").html(view_label[view]);
	if (view=='list'){
		var html = "Cette rubrique présente la liste des CV ...";
		$("#description").html(html);
	}
	if (view=='create') {
		var html = "Cette rubrique vous permet de créer un CV ...";
		$("#description").html(html);
	}
	$("#wait-window").show();
	var l_userrole = 'etudiant';

	
	//====================================
	function selectPortfolio(data)
	//====================================
	{
		var codePortfolio = "IUT2-portfolio";// + useridentifier;
		var codeProfile = "-profile";
		var codeCV = "-cv";
		var portfolios = $("portfolio",data);
		UIFactory["Portfolio"].parse(data);
		for ( var i=0;i<portfolios.length;i++)
			{
			var current_code = $("code:first",portfolios[i]).text();
			if (current_code.indexOf(codePortfolio)>-1) {
				g_portfolioid = $(portfolios[i]).attr("id");
			}
			if (current_code.indexOf(codeProfile)>-1) {
				g_profileid = $(portfolios[i]).attr("id");
			}
			if (current_code.indexOf(codeCV)>-1) {
				g_cvid = $(portfolios[i]).attr("id");
			}
		}


		$.ajaxSetup({async: false});
		//----------------
		$.ajax({ // get group-role for the user
			Accept: "application/xml",
			type : "GET",
			dataType : "xml",
			url : "../../../"+serverBCK+"/credential/group/" + g_portfolioid,
			success : function(data) {
				var usergroups = $("group",data);
				g_userrole = $("role",usergroups[0]).text();
			}
		});
		//---------------- Portfolio --------------------------
		$.ajax({
			type : "GET",
			dataType : "xml",
			url : "../../../"+serverBCK+"/portfolios/portfolio/"+g_portfolioid+"?resources=true",
			success : function(data) {
				UICom.parseStructure(data,'portfolio');
				UIFactory["Profile"].parse(proxies_data['proxy-profile']);
				if (view=='create') {
					//--------------------
					UIFactory["Diploma"].parse(data);
					//--------------------
					UIFactory["Formation"].parse(data);
					//--------------------
					UIFactory["Experience"].parse(data);
					//--------------------
					UIFactory["Stage"].parse(data);
					//--------------------
					UIFactory["Alternance"].parse(data);
					//--------------------
					UIFactory["ExperiencePerso"].parse(data);
					//--------------------
					UIFactory["Langue"].parse(data);
					mother_tongueid = $("asmContext:has(metadata[semantictag='MotherTongue'])", data).attr('id');
					//-----------------------------------------------
					tableau = searchCompetencies(data,'domaine-metier','activite','competence-metier');
					htmlShort1 += getShortCompetencies(tableau,1);
					g_htmlDetail1 += getDetailCompetencies(tableau,1);
					//-----------------------------------------------
					tableau = searchCompetencies(data,'dom-metier-ref','dom-metier-ref','free-comp-metier');
					htmlShort1 += getShortCompetencies(tableau,2);
					g_htmlDetail1 += getDetailCompetencies(tableau,2);
					//----------------------------
//								$("#metiers-short").html(htmlShort);
//								$("#metiers-detail").html(g_htmlDetail1);
					//-----------------------------------------------
					var tableau = null;
					tableau = searchCompetencies(data,null,'activite','competence-trans');
					htmlShort2 += getShortCompetencies(tableau,3);
					g_htmlDetail2 += getDetailCompetencies(tableau,3);
					comps2_objs = $("metadata[semantictag*='comps2a-autres']",data).parent()
					tableau = searchCompetencies(comps2_objs,null,'dom-autre-ref','free-comp-autre');
					htmlShort2 += getShortCompetencies(tableau,4);
					g_htmlDetail2 += getDetailCompetencies(tableau,4);
					comps2_objs = $("metadata[semantictag*='comps2b-autres']",data).parent()
					tableau = searchCompetencies(comps2_objs,null,'dom-autre-ref','free-comp-autre');
					htmlShort2 += getShortCompetencies(tableau,5);
					g_htmlDetail2 += getDetailCompetencies(tableau,5);
					//----------------------------
//								$("#autres-short1").html(htmlShort);
//								$("#autres-detail1").html(htmlDetail);
					//-----------------------------------------------
					comps2_objs = $("metadata[semantictag*='comps2c-autres']",data).parent()
					tableau = searchCompetencies(comps2_objs,null,'dom-autre-ref','free-comp-autre');
					htmlShort3 += getShortCompetencies(tableau,6);
					g_htmlDetail3 += getDetailCompetencies(tableau,6);
					//----------------------------
//								$("#autres-short2").html(htmlShort);
//								$("#autres-detail2").html(htmlDetail);
					//-----------------------------------------------
				}
			}
		});
		$("#accueil").attr("href","mainEtudiant.htm?portfolioid="+g_portfolioid);
		var navbar = getNavbar(g_portfolioid,g_profileid);
		$("#navbar").html(navbar);
		if (l_userrole=='etudiant' && g_userrole!='etudiant'){
			profiles_list[0].displayView('profile-etudiant','lastname_firstname');
		}
		//---------------- CVs --------------------------
		$.ajax({
			type : "GET",
			dataType : "xml",
			url : "../../../"+serverBCK+"/portfolios/portfolio/"+g_cvid+"?resources=true",
			success : function(data) {
				UICom.parseStructure(data,'cvs');
				UIFactory["CV"].parse(data);
				if (view=='list'){
					cvs_Display('list_cvs','short');
				}
				if (view=='create') {
					g_cv.displayEditor('list_cvs','detail');
				}
				$("#wait-window").hide();
			}
		});
		//-----------------------------------------------
	}
	

	$(document).ready(function() {
		$("#footer").html(footer);
		//----------------
		$.ajax({
			type : "GET",
			dataType : "xml",
			url : "../../../"+serverBCK+"/credential",
			data: "",
			success : function(data) {
				USER = new UIFactory["User"]($("user",data));
				//----------------
				$.ajax({
					Accept: "application/xml",
					contentType: "application/xml",
					type : "GET",
					dataType : "xml",
					url : "../../../"+serverBCK+"/portfolios?active=1",
					success : function(data) {
						selectPortfolio(data);
					}
				});
				//----------------
			}
		});
	});


	</script>
</body>
</html>

